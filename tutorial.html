<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Tutorial</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_tutorial">Tutorial</a>
<ul class="sectlevel2">
<li><a href="#_what_is_an_object_pool">What is an Object Pool?</a></li>
<li><a href="#_when_should_i_use_an_object_pool">When Should I use an Object Pool?</a></li>
<li><a href="#_the_elements_of_an_object_pool">The Elements of an Object Pool</a></li>
<li><a href="#_object_pooling_in_practice">Object Pooling in Practice</a></li>
<li><a href="#_more_elements_of_stormpot">More Elements of Stormpot</a></li>
<li><a href="#_configuring_stormpot">Configuring Stormpot</a></li>
<li><a href="#_directly_pooling_objects">Directly Pooling Objects</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_tutorial">Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial assumes no prior understanding of object pooling, and will introduce the concept bit by bit.
The aim is to gradually build up knowledge about object pooling in general, when to use pooling, and how to pool objects with Stormpot specifically.</p>
</div>
<div class="sect2">
<h3 id="_what_is_an_object_pool">What is an Object Pool?</h3>
<div class="paragraph">
<p>An object pool is a homogeneous collection of objects.
Whenever one such object is needed for something, it is taken from the pool instead of being allocated anew.
Once an object has served its purpose, it returns to the pool so that it can later be reused.
We say the collection of pooled objects is homogeneous, because it does not matter which of the objects are picked to be used in a given case.
This is where pools differs from caches: in a cache, the objects are distinct, and have some identity by which they are looked up when needed.
In a pool, there is nothing to look up by, and any object will do.</p>
</div>
<div class="paragraph">
<p>The purpose of the pool, is to prevent as many allocations of the pooled objects as possible, with as little overhead as possible.
If the objects being pooled represent a limited resource, a secondary purpose of the pool is to enforce an upper bound on the number of these objects that are in use, at any given time.</p>
</div>
<div class="paragraph">
<p>When a pool represents a limited resource, then it is often shared among multiple threads.
An example of this could be a database connection pool in a typical Java web application.
Such pool implementations obviously need to be thread-safe, and Stormpot fits this bill.
In Stormpot, there is always an upper bound on how many pooled object instances there can exist at any one time, and the Stormpot pool implementations are indeed thread-safe.</p>
</div>
</div>
<div class="sect2">
<h3 id="_when_should_i_use_an_object_pool">When Should I use an Object Pool?</h3>
<div class="paragraph">
<p>Java is a garbage collected language.
Objects are allocated on a shared heap of memory.
The garbage collector provides the illusion of infinite memory, by periodically removing unused objects from the heap.
This is the most efficient way to allocate and free memory.</p>
</div>
<div class="paragraph">
<p>Most object allocations in Java are done by bumping a pointer into a thread-local allocation buffer.
This common fast-path allocation is typically just 10 native instructions.
Once the memory has been allocated, the object has to be initialised with the object initialiser, and constructed with the constructor.</p>
</div>
<div class="paragraph">
<p>Freeing memory is done in batches, called collections, following the allocation rate and the demand for new memory.
The garbage collector traces through the object graph, finding all the objects that are live and in use.
All the objects that are not live, are garbage and can be collected.
This often means that the threads of the application, the mutator threads, needs to be paused so the collector can get a consistent view of what is live and what is not.
These pauses are a necessary evil of a garbage collector.
The pause times scale with the number of live objects, not the size of the heap, so high object retention has a bigger performance impact than a high allocation rate.</p>
</div>
<div class="paragraph">
<p>An object pool cannot beat the garbage collector on throughput and latency of memory allocation and freeing, because the pool will necessarily have to do some form of synchronisation to coordinate access to its limited set of objects.
In other words, if objects are pooled for performance reasons, the cost of the object initialisation and construction must outweigh the overhead of the pool.
This leaves us with only two good cases for object pooling:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Objects that have very expensive initialisation or construction.</p>
</li>
<li>
<p>Objects that represent a limited resource, such as network connections or threads.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Java already does thread pooling with the <code>Executors</code> framework, so this use case is solved.
This leaves network connections&#8201;&#8212;&#8201;for instance to a database, or some other kind of remote service&#8201;&#8212;&#8201;as the archetypical example of something you want to pool.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_elements_of_an_object_pool">The Elements of an Object Pool</h3>
<div class="paragraph">
<p>There are three central elements to a pool, and a number of peripheral elements.
The central elements are the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The objects being pooled.
In Stormpot terms, these are a subtype of <code>Poolable</code>, and their number per pool is determined by the configured size of the given pool.
The implementation of the <code>Poolable</code> interface is supplied by the user code, through the <code>Allocator</code>.</p>
</li>
<li>
<p>The <code>Allocator</code> creates and destroys the objects being pooled, with the <code>allocate</code> and <code>deallocate</code> methods, respectively.
There is one allocator per pool, and it is supplied to the pool through the pool configuration, typically via the <code>Pool.from</code> method.</p>
</li>
<li>
<p>The pool itself, which is an implementation of the <code>Pool</code> API.
Implementations of this API is supplied by the Stormpot library.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The pool lets interested parties <code>claim</code> objects as needed, and expects them to be returned via a call to the <code>release</code> method on the <code>Poolable</code> interface.
The <code>release</code> method on the poolable works by delegating to a <code>Slot</code> object that was given to the poolable, through the allocator, when the poolable was created.
It is the job of the pool to turn as many calls to <code>claim</code> and <code>release</code> into as few calls to <code>allocate</code> and <code>deallocate</code> as possible.
The pool has to do this with the smallest overhead possible, and while observing the configured upper bound on the number of objects.</p>
</div>
<div class="paragraph">
<p>This upper bound is called the size of the pool.
When all the objects in the pool are claimed, the pool is said to be depleted.
If you call <code>claim</code> on a depleted pool, the call will block until at least one object is released back to the pool.
More than one thread at a time can be blocked trying to claim objects from the pool.
The claim call does not guarantee fairness, so there is no way to know before hand, which of the threads will be unblocked when an object is released.</p>
</div>
<div class="paragraph">
<p>The pool has a background thread dedicated to allocating and deallocating the poolable objects, because these are presumably expensive operations.
This way, the threads that come to the pool to claim objects, don&#8217;t have to pay the cost of allocating those objects.
This reduces the latency for claim in the general case.</p>
</div>
<div class="paragraph">
<p>In essence, the central parts of the pool fit together like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diag-13dba6b1bad7bf1e24f4a61548f73fe1.png" alt="diag 13dba6b1bad7bf1e24f4a61548f73fe1" width="820" height="266">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_pooling_in_practice">Object Pooling in Practice</h3>
<div class="paragraph">
<p>Let&#8217;s take what we learned in the previous section, and put it into practice.
It is clear from the diagram and the explanation, that we need to do two things for the type of the objects we want to pool:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They have to implement the <code>Poolable</code> interface.</p>
</li>
<li>
<p>They need a field for the <code>Slot</code> object with which they will inform the pool when they are released.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The simplest possible implementation of this looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// MyPoolable.java - minimum Poolable implementation</span>
<span class="keyword">import</span> <span class="include">stormpot.BasePoolable</span>;
<span class="keyword">import</span> <span class="include">stormpot.Slot</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyPoolable</span> <span class="directive">extends</span> BasePoolable {
  <span class="directive">public</span> MyPoolable(Slot slot) {
    <span class="local-variable">super</span>(slot);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the <code>Poolable</code> interface is largely left to the <code>BasePoolable</code> class.
Objects of this class don&#8217;t really do much, other than correctly implementing the <code>Poolable</code> interface.
However, it is a skeleton to which we can add the functionality and the expensive resources that are the reason we are pooling these objects in the first place.</p>
</div>
<div class="paragraph">
<p>Next, the pool can&#8217;t create instances of this class by itself.
It needs the help of an <code>Allocator</code> implementation to do that.
The allocation of these objects will be happening in a dedicated allocation thread, such that this thread pays the cost of the presumably expensive allocation.
Therefor, it is generally a good idea to do as much work as possible during the allocation, such that it is as cheap as possible to claim and use the objects.
There is one moderation to this rule, however, because the pool only has one allocation thread.
The more expensive objects are to create, the longer it will take to fill the pool.
Likewise, if the objects expire and churn with a high rate, the allocation thread might not be able to keep up with the demand for reallocations.</p>
</div>
<div class="paragraph">
<p>Here is what an <code>Allocator</code> that allocates the above objects, can look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// MyAllocator.java - minimum Allocator implementation</span>
<span class="keyword">import</span> <span class="include">stormpot.Allocator</span>;
<span class="keyword">import</span> <span class="include">stormpot.Slot</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyAllocator</span> <span class="directive">implements</span> Allocator&lt;MyPoolable&gt; {
  <span class="directive">public</span> MyPoolable allocate(Slot slot) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="keyword">return</span> <span class="keyword">new</span> MyPoolable(slot);
  }

  <span class="directive">public</span> <span class="type">void</span> deallocate(MyPoolable poolable) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">// Nothing to do here</span>
    <span class="comment">// But it's a perfect place to close sockets, files, etc.</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s not much to it.
The <code>allocate</code> method gets the <code>Slot</code> instance that the specific <code>Poolable</code> has to use, for informing the pool when it is released.
If the <code>allocate</code> method throws an exception, or returns null, the allocation is considered a failure.
Failed allocations may bubble out of <code>claim</code> calls, as the cause of a <code>PoolException</code>.
They might also not bubble out, because the pool keeps track of how many allocations have failed, and will automatically retry the allocations until they succeed.
If that happens, the exception is simply discarded.
This is called proactive reallocation.
Meanwhile, failed allocations still count towards the size of the pool, so there are only so many exceptions that the pool can contain at any given time.</p>
</div>
<div class="paragraph">
<p>This combination of bubbling exceptions out through <code>claim</code>, and proactive reallocation, means that the pool copes well with failure.
If there are periods where the allocator cannot create new objects – for instance if the objects need some kind of network connection, but the network has been disconnected – then the user code that calls <code>claim</code> will not wait for the entire duration of the timeout, to be notified of the failure condition, but instead immediately get an exception.
Then, when the failure condition is corrected – for instance if the network comes back up, to continue that example – then the proactive reallocation will begin replacing the failed allocations with good ones.
This way, the user code doesn&#8217;t have to go through a whole pool full of exceptions, to get a useful object.</p>
</div>
<div class="paragraph">
<p>Now, we have a type of object that we want to pool, and we have an <code>Allocator</code> implementation that can create them.
All that is left to do, is to configure and instantiate a pool, and put it to use.
Here&#8217;s a simple example of what this could look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    Pool&lt;MyPoolable&gt; pool = Pool.from(<span class="keyword">new</span> MyAllocator()).build();
    Timeout timeout = <span class="keyword">new</span> Timeout(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);

    MyPoolable object = pool.claim(timeout);
    <span class="keyword">try</span> {
      <span class="comment">// Do stuff with 'object'.</span>
      <span class="comment">// Note that 'claim' will return 'null' if it times out!</span>
    } <span class="keyword">finally</span> {
      <span class="keyword">if</span> (object != <span class="predefined-constant">null</span>) {
        object.release();
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Pool.from</code> method takes the allocator and returns a <code>PoolBuilder</code>, that contains the given allocator and some default configurations.
The <code>PoolBuilder</code> can then be configured further if we so desire, or we can use it to create our <code>Pool</code> instance.
Once a pool object has been created, it is immediately ready for use, though the calls to <code>claim</code> might block until a sufficient number of objects has been created.</p>
</div>
</div>
<div class="sect2">
<h3 id="_more_elements_of_stormpot">More Elements of Stormpot</h3>
<div class="paragraph">
<p>When it comes to object pooling with Stormpot specifically, there is more to it than the three central elements of the pool, the poolable objects and the allocator.
We have already seen the slot object, and how it is used to inform the pool when an object is released.
And we have seen the dedicated allocator thread, that uses the allocator to keep the pool filled with objects.
We have also seen hints at the life cycle of the pooled objects: first they are allocated, then they are claimed and released a number of times, and finally they are deallocated.</p>
</div>
<div class="paragraph">
<p>There are three reasons an object can get deallocated: the object expired, the pool was resized to be smaller, or the pool was shut down.
These three situations are particular to how Stormpot works.</p>
</div>
<div class="sect3">
<h4 id="_object_expiration">Object Expiration</h4>
<div class="paragraph">
<p>Whether or not an object has expired is decided by the configured <code>Expiration</code> strategy on every call to the <code>claim</code> method.
If the <code>claim</code> method finds an object that has expired, then it is sent off to be deallocated, and another candidate object is tried.
The <code>hasExpired</code> method of the configured expiration is therefor very performance critical, as it may be called more than once for every call to the <code>claim</code> method.</p>
</div>
<div class="paragraph">
<p>You can implement and configure your own <code>Expiration</code> implementation if you want, but Stormpot also comes with a couple of implementations of its own.
The default expiration policy expires objects after they&#8217;ve been circulating for somewhere between 8 to 10 minutes.
This implementation chooses the expiration age randomly on a per object bases, and thereby avoids expiring all objects at the same time.</p>
</div>
<div class="paragraph">
<p>If something out of the ordinary happens, and an object expires while it is claimed (depending on what "expired" means for your use case), then the object can be explicitly expired with the <code>expire</code> method on the <code>Slot</code>.
The <code>expire</code> method must be called while the object is still claimed, and the expiration will not take effect until the object is released.
Once released, the explicitly expired object cannot be claimed again, and it will be deallocated.
The <code>BasePoolable</code> class re-exposes the <code>expire</code> method for convenience.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pool_resizing">Pool Resizing</h4>
<div class="paragraph">
<p>A pool is configured with an initial size, through the the size property of the <code>PoolBuilder</code>.
However, this size is not fixed.
The target size can be set and queried whenever desired, using the relevant methods on the <code>Pool</code>.
Changing the size on the <code>PoolBuilder</code> has no effect on pools that have already been constructed.</p>
</div>
<div class="paragraph">
<p>The <code>setTargetSize</code> method allows anyone with access to the pool instance, to grow or shrink the pool as they see fit.
This works by immediately setting the target pool size to the new value.
There is no way to tell when the pool will actually reach the new target size.
Once a new target size has been set, the pool will work towards the set goal at its own pace.
The reason is that when the pool is shrunk, it cannot force currently claimed objects to suddenly be released, so that they can be deallocated.
Likewise, it takes time to allocate the new objects when the pool is grown.
The pool is otherwise designed to never have more objects than its target size, allocated at any one point in time.
Obviously this isn&#8217;t so when the pool is in the process of shrinking towards a new smaller size.
The resizing process itself works by simply allocating more objects than are deallocated, when the pool is growing, or by deallocating more objects than are allocated, when the pool is shrinking.</p>
</div>
</div>
<div class="sect3">
<h4 id="_shutting_the_pool_down">Shutting the Pool Down</h4>
<div class="paragraph">
<p>Calling the <code>shutdown</code> method on a <code>Pool</code> initiates the shutdown process, but does not wait for it to complete.
The pool is not fully shut down until all the objects in it have been deallocated.
This can take a while, since objects that are claimed and in use cannot be deallocated until they are released back to the pool.
How long this takes depends entirely on the user code.
It also means that if an object has leaked – that is, it has been claimed and then forgotten, never to be released back to the pool – then the shut down process will never complete.</p>
</div>
<div class="paragraph">
<p>The <code>shutdown</code> method returns a <code>Completion</code> object, that allow you to <code>await</code> the completion of the shut down process.
The <code>await</code> method takes a <code>Timeout</code> object, so it doesn&#8217;t wait forever, and returns boolean <code>true</code> if the shut down process completed within the given timeout period.
This is the only way to tell whether or not the shut down process has completed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_timeouts">Timeouts</h4>
<div class="paragraph">
<p>All blocking operations in the Stormpot API take <code>Timeout</code> objects as arguments.
While timeout objects can represent very long timeouts, they cannot extend for an eternity.
This, at least in principle, prevents the blocking methods from waiting for forever.
The main blocking methods are the <code>claim</code> method on the <code>Pool</code> interface, and the <code>await</code> method on the <code>Completion</code> interface mentioned in the previous section.
Other blocking methods are implemented in terms of these two.</p>
</div>
<div class="paragraph">
<p><code>Timeout</code> objects are immutable value objects, so they are fine to keep in <code>static final</code> fields and shared among multiple threads.
They also have unit independent equality semantics, so a timeout of 1 second is equal to a timeout of 1000 milliseconds.
Timeouts are also independent of variable calendar time, meaning that they don&#8217;t grow or shrink with passing leap seconds or daylight savings time adjustments.</p>
</div>
<div class="paragraph">
<p>The <code>Timeout</code> objects have a number of methods that expose the mechanics of how Stormpot uses the timeout objects, but you need not concern yourself with that, unless you want to use it in your own implementations of blocking operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reallocator">Reallocator</h4>
<div class="paragraph">
<p><code>Reallocator</code> is an interface that extends the <code>Allocator</code> interface, and adds a <code>reallocate</code> method.
This method is a combination of <code>deallocate</code> and <code>allocate</code>, in that order, and has the opportunity for reusing the <code>Poolable</code> instances.
This can help reduce object churn and fragmentation in the old heap generation, thus helping to delay or prevent the full garbage collection pauses.</p>
</div>
<div class="paragraph">
<p>Reallocators can also be used to implement a more expensive expiration check.
See the <a href="performance.html">performance</a> page on how to do that.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_stormpot">Configuring Stormpot</h3>
<div class="paragraph">
<p>Stormpot is configured by setting properties of the <code>PoolBuilder</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PoolBuilder</code> objects are mutable, and the setter methods return the same modified instance.
They are also <code>Cloneable</code>, so code that prefers to work on its own private instance can do so by calling <code>clone</code>.</p>
</div>
<div class="paragraph">
<p>Once a pool has been constructed with a particular configuration, it no longer needs the <code>PoolBuilder</code>.
A snapshot of the pool configuration is captured in the pool itself, and the <code>PoolBuilder</code> will no longer be consulted by that pool.
This allows you to modify and reuse the <code>PoolBuilder</code> for constructing other pool instances.</p>
</div>
<div class="paragraph">
<p>The <code>Allocator</code> instance is the only thing that <em>must</em> be configured, and this is enforced by the <code>Pool.from</code> method.
All the other configuration properties have somewhat reasonable default values.</p>
</div>
<div class="paragraph">
<p>Other properties that might be interesting to configure, include the pool size, and the <code>Expiration</code> instance.
See the <a href="config.html">configuration reference</a> page for more information on how to configure Stormpot.</p>
</div>
</div>
<div class="sect2">
<h3 id="_directly_pooling_objects">Directly Pooling Objects</h3>
<div class="paragraph">
<p>Stormpot comes with an alternative operating mode, where the objects to be pooled are directly given to the pool upon construction, rather than being allocated and maintained in the background.</p>
</div>
<div class="paragraph">
<p>This mode is enabled by creating the pool with the <code>Pool.of(&#8230;&#8203;)</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">Object</span> a = <span class="keyword">new</span> <span class="predefined-type">Object</span>();
    <span class="predefined-type">Object</span> b = <span class="keyword">new</span> <span class="predefined-type">Object</span>();
    <span class="predefined-type">Object</span> c = <span class="keyword">new</span> <span class="predefined-type">Object</span>();
    Pool&lt;Pooled&lt;<span class="predefined-type">Object</span>&gt;&gt; pool = Pool.of(a, b, c);
    <span class="keyword">try</span> (Pooled&lt;<span class="predefined-type">Object</span>&gt; claim = pool.claim(TIMEOUT)) {
      <span class="keyword">if</span> (claim != <span class="predefined-constant">null</span>) {
        <span class="predefined-type">System</span>.out.println(claim.object);
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this mode, all the given objects are immediately available to be claimed, instead of having to wait for a background thread to allocate them.
The objects given are never expired, and never deallocated.
Explicitly expired objects are simply returned to the pool.
Precise leak detection is also turned off.</p>
</div>
<div class="paragraph">
<p>This means that no background thread is started for pools created in this mode, which makes them much more light weight.
This makes mode good for temporary and short-lived pools, or for when the objects are effectively immortal and can be allocated up-front.</p>
</div>
<div class="paragraph">
<p>One drawback of this mode, is that the pool cannot be resized.
The size of these pools are fixed, and given by the number of objects passed to the <code>Pool.of(&#8230;&#8203;)</code> method.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-05-15 13:04:08 +0200
</div>
</div>
</body>
</html>